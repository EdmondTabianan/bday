<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Birthday Surprise</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: #ffe0f7;
    font-family: 'Poppins', sans-serif;
    position: relative;
    overflow: hidden;
    padding: 20px;
  }

  /* Gift Modal */
  .gift-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    padding: 20px;
  }

  .gift-content {
    background: #fff0f6;
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(255,182,193,0.5);
    animation: modalAppear 0.5s ease;
    max-width: 500px;
    width: 100%;
  }

  .gift-content h1 {
    color: #ff69b4;
    margin-bottom: 30px;
    font-size: clamp(1.8rem, 6vw, 2.5rem);
  }

  .gift-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .gift-btn {
    padding: 15px 30px;
    border: none;
    border-radius: 10px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 120px;
  }

  .open-btn {
    background: #4CAF50;
    color: white;
  }

  .open-btn:hover {
    background: #45a049;
    transform: translateY(-2px);
  }

  .dont-open-btn {
    background: #ff4444;
    color: white;
  }

  .dont-open-btn:hover {
    background: #ff3333;
    transform: translateY(-2px);
  }

  /* Cake Container - Initially Hidden */
  .cake-container {
    display: none;
    position: relative;
    text-align: center;
    flex-direction: column;
    align-items: center;
    gap: 30px;
    width: 100%;
  }

  /* Instructions with proper spacing */
  .instructions {
    background: rgba(255, 255, 255, 0.95);
    padding: 25px 30px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(255, 105, 180, 0.3);
    border: 3px solid #ff69b4;
    width: min(90%, 400px);
  }

  .instructions h2 {
    color: #ff69b4;
    margin-bottom: 15px;
    font-size: clamp(1.4rem, 5vw, 1.8rem);
    line-height: 1.3;
  }

  .instructions p {
    color: #6d3d57;
    font-size: clamp(1rem, 4vw, 1.1rem);
    line-height: 1.5;
    margin: 0;
  }

  /* Cake Layers - Responsive */
  .cake {
    position: relative;
    width: min(300px, 90vw);
    height: min(200px, 60vw);
    border-radius: 0 0 20px 20px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    background: linear-gradient(to bottom, #ffb6c1 60%, #ff69b4 100%);
    overflow: visible;
  }

  /* Icing */
  .icing {
    position: absolute;
    top: -20px;
    left: 0;
    width: 100%;
    height: 40px;
    background: #fff0f6;
    border-radius: 50% 50% 0 0;
    box-shadow: 0 5px 10px rgba(255, 182, 193, 0.3);
    z-index: 1;
  }

  /* Candles Container */
  .candles {
    position: absolute;
    top: -60px;
    width: 100%;
    height: 50px;
    z-index: 2;
  }

  .candles .candle {
    position: absolute;
    width: 15px;
    height: 50px;
    background: #fff;
    border-radius: 3px;
    border: 2px solid #ff69b4;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    z-index: 3;
  }

  /* Flames */
  .candles .flame {
    position: absolute;
    top: -20px;
    left: 50%;
    transform: translateX(-50%);
    width: 10px;
    height: 20px;
    background: radial-gradient(circle, #ffeb3b, #ff9800, #ff5722);
    border-radius: 50% 50% 20% 20%;
    animation: flicker 0.3s infinite alternate;
    z-index: 4;
    transition: all 0.5s ease;
    box-shadow: 0 0 20px #ff9800;
  }

  .flame.blown {
    opacity: 0;
    transform: translateX(-50%) scale(0.1);
    animation: none;
  }

  .flame.smoke::after {
    content: '';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 8px;
    height: 15px;
    background: rgba(128, 128, 128, 0.6);
    border-radius: 50%;
    animation: smokeRise 1.5s ease-out forwards;
  }

  @keyframes flicker {
    0% { transform: translateX(-50%) scale(1) rotate(-2deg); }
    25% { transform: translateX(-50%) scale(1.1) rotate(1deg); }
    50% { transform: translateX(-50%) scale(0.9) rotate(2deg); }
    75% { transform: translateX(-50%) scale(1.05) rotate(-1deg); }
    100% { transform: translateX(-50%) scale(1) rotate(0deg); }
  }

  @keyframes smokeRise {
    0% { 
      opacity: 0.8; 
      transform: translateX(-50%) translateY(0) scale(1);
    }
    100% { 
      opacity: 0; 
      transform: translateX(-50%) translateY(-50px) scale(2);
    }
  }

  @keyframes modalAppear {
    from {
      opacity: 0;
      transform: scale(0.8) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  /* Decorations */
  .decoration {
    position: absolute;
    width: 10px;
    height: 10px;
    background: #ff69b4;
    border-radius: 50%;
    z-index: 1;
  }

  .decoration:nth-child(1) { top: 20px; left: 30px; }
  .decoration:nth-child(2) { top: 40px; left: 80px; }
  .decoration:nth-child(3) { top: 60px; left: 200px; }
  .decoration:nth-child(4) { top: 30px; left: 250px; }

  /* Sprinkles */
  .sprinkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: #fff;
    border-radius: 50%;
    z-index: 1;
  }

  .sprinkle:nth-child(5) { top: 10px; left: 60px; }
  .sprinkle:nth-child(6) { top: 15px; left: 150px; }
  .sprinkle:nth-child(7) { top: 25px; left: 100px; }
  .sprinkle:nth-child(8) { top: 35px; left: 180px; }

  /* Particle Effects */
  .particle {
    position: absolute;
    pointer-events: none;
    z-index: 5;
  }

  /* Greeting Modal - FIXED */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10;
    padding: 20px;
  }

  .modal-content {
    background: #fff0f6;
    padding: 30px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(255,182,193,0.5);
    animation: modalAppear 0.5s ease;
    width: min(90%, 400px);
    max-width: 400px;
    margin: 0 auto;
  }

  .modal-content h1 {
    color: #ff69b4;
    margin-bottom: 20px;
    font-size: clamp(1.5rem, 5vw, 2rem);
    line-height: 1.3;
  }

  .modal-content p {
    color: #6d3d57;
    font-size: clamp(0.9rem, 3vw, 1.1rem);
    margin-bottom: 25px;
    line-height: 1.5;
  }

  .modal-content a {
    display: inline-block;
    padding: 12px 25px;
    background: #ff69b4;
    color: #fff;
    border-radius: 10px;
    text-decoration: none;
    font-weight: bold;
    transition: background 0.3s;
    font-size: clamp(0.9rem, 3vw, 1rem);
  }

  .modal-content a:hover {
    background: #ff85c1;
  }

  /* Mobile-specific adjustments */
  @media (max-width: 768px) {
    body {
      padding: 15px;
      justify-content: flex-start;
      padding-top: 80px;
    }

    .cake-container {
      gap: 30px;
    }

    .instructions {
      margin-bottom: 0;
      padding: 20px 25px;
      width: 95%;
    }

    .instructions h2 {
      margin-bottom: 12px;
      font-size: 1.5rem;
    }

    .instructions p {
      font-size: 1rem;
    }

    .cake {
      width: 280px;
      height: 180px;
    }

    .candles .candle {
      width: 12px;
      height: 45px;
    }

    .candles .flame {
      width: 8px;
      height: 16px;
    }

    /* Adjust candle positions for mobile */
    .candle:nth-child(1) { left: 40px !important; }
    .candle:nth-child(2) { left: 120px !important; }
    .candle:nth-child(3) { left: 200px !important; }

    .gift-content {
      padding: 30px 20px;
    }

    .gift-buttons {
      gap: 15px;
    }

    .gift-btn {
      padding: 12px 25px;
      min-width: 110px;
    }

    /* Modal adjustments for mobile */
    .modal-content {
      padding: 25px;
      width: 95%;
      max-width: 350px;
    }
  }

  @media (max-width: 480px) {
    body {
      padding: 10px;
      padding-top: 60px;
    }

    .instructions {
      padding: 18px 20px;
    }

    .instructions h2 {
      font-size: 1.3rem;
      margin-bottom: 10px;
    }

    .instructions p {
      font-size: 0.95rem;
    }

    .cake {
      width: 260px;
      height: 170px;
    }

    .candle:nth-child(1) { left: 35px !important; }
    .candle:nth-child(2) { left: 115px !important; }
    .candle:nth-child(3) { left: 195px !important; }

    .modal-content {
      padding: 20px;
      width: 95%;
      max-width: 320px;
    }

    .modal-content h1 {
      font-size: 1.4rem;
    }

    .modal-content p {
      font-size: 0.9rem;
    }
  }

  @media (max-width: 320px) {
    .cake {
      width: 240px;
      height: 160px;
    }

    .candle:nth-child(1) { left: 30px !important; }
    .candle:nth-child(2) { left: 105px !important; }
    .candle:nth-child(3) { left: 180px !important; }

    .modal-content {
      padding: 15px;
      max-width: 280px;
    }
  }

  /* Landscape mode adjustments */
  @media (max-height: 600px) and (orientation: landscape) {
    body {
      padding: 10px;
      padding-top: 70px;
    }

    .cake-container {
      gap: 20px;
    }

    .instructions {
      padding: 15px 20px;
    }

    .cake {
      width: 220px;
      height: 150px;
    }

    .candles .candle {
      height: 40px;
    }

    .candles {
      top: -50px;
    }

    .modal-content {
      padding: 20px;
      max-width: 300px;
    }
  }
</style>
</head>
<body>

<!-- Gift Modal -->
<div class="gift-modal" id="giftModal">
  <div class="gift-content">
    <h1>üéÅ Open This Gift? üéÅ</h1>
    <div class="gift-buttons">
      <button class="gift-btn open-btn" onclick="openGift()">Open!</button>
      <button class="gift-btn dont-open-btn" onclick="dontOpenGift()">Don't Open</button>
    </div>
  </div>
</div>

<!-- Cake Container -->
<div class="cake-container" id="cakeContainer">
  <!-- Instructions with proper spacing -->
  <div class="instructions">
    <h2>Blow Out the Candles! üéÇ</h2>
    <p>Blow into your microphone to extinguish all the candles!</p>
  </div>

  <div class="cake">
    <div class="icing"></div>

    <!-- Decorations -->
    <div class="decoration"></div>
    <div class="decoration"></div>
    <div class="decoration"></div>
    <div class="decoration"></div>

    <!-- Sprinkles -->
    <div class="sprinkle"></div>
    <div class="sprinkle"></div>
    <div class="sprinkle"></div>
    <div class="sprinkle"></div>

    <!-- Candles -->
    <div class="candles">
      <div class="candle" style="left: 50px;"><div class="flame"></div></div>
      <div class="candle" style="left: 130px;"><div class="flame"></div></div>
      <div class="candle" style="left: 210px;"><div class="flame"></div></div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="greetingModal">
  <div class="modal-content">
    <h1>Happy Birthday! üéâ</h1>
    <p>Wishing you a wonderful day filled with love and joy!</p>
    <a href="page2.html">next</a>
  </div>
</div>

<!-- Audio Element -->
<audio id="backgroundMusic" loop>
  <source src="songs.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
// DOM Elements
const giftModal = document.getElementById('giftModal');
const cakeContainer = document.getElementById('cakeContainer');
const backgroundMusic = document.getElementById('backgroundMusic');

// Gift interaction functions
function openGift() {
  // Hide gift modal
  giftModal.style.display = 'none';
  
  // Show cake and instructions
  cakeContainer.style.display = 'flex';
  
  // Play background music
  playBackgroundMusic();
  
  // Initialize the candle blowing game
  initCandleGame();
}

function dontOpenGift() {
  // Create a fun persuasive message
  const giftContent = document.querySelector('.gift-content');
  giftContent.innerHTML = `
    <h1>üéÅ Are you sure? üéÅ</h1>
    <p style="margin-bottom: 20px; color: #6d3d57; font-size: 1.1rem;">
      There's a wonderful surprise waiting inside!<br>
      Don't you want to see what it is? üéÇ
    </p>
    <div class="gift-buttons">
      <button class="gift-btn open-btn" onclick="openGift()">Yes, Open It!</button>
      <button class="gift-btn dont-open-btn" onclick="reallyDontOpen()">No, Really Don't</button>
    </div>
  `;
}

function reallyDontOpen() {
  // Final persuasive attempt
  const giftContent = document.querySelector('.gift-content');
  giftContent.innerHTML = `
    <h1>üéÅ Last Chance! üéÅ</h1>
    <p style="margin-bottom: 20px; color: #6d3d57; font-size: 1.1rem;">
      It's a birthday cake with candles to blow! üéÇ<br>
      With music and celebrations! üéâ<br>
      Are you sure you don't want to open it?
    </p>
    <div class="gift-buttons">
      <button class="gift-btn open-btn" onclick="openGift()" style="background: #4CAF50;">OPEN THE GIFT!</button>
      <button class="gift-btn dont-open-btn" onclick="forceOpen()" style="background: #ff9800;">I'm Too Shy</button>
    </div>
  `;
}

function forceOpen() {
  // Auto-open after final refusal
  const giftContent = document.querySelector('.gift-content');
  giftContent.innerHTML = `
    <h1>üéÅ Too Bad! üéÅ</h1>
    <p style="margin-bottom: 20px; color: #6d3d57; font-size: 1.1rem;">
      We're opening it anyway! Get ready for fun! üéâ
    </p>
    <div style="font-size: 3rem; margin: 20px 0;">üéÇ‚ú®</div>
  `;
  
  setTimeout(openGift, 2000);
}

// Music function
function playBackgroundMusic() {
  // Try to play music with user interaction
  backgroundMusic.volume = 0.7;
  const playPromise = backgroundMusic.play();
  
  if (playPromise !== undefined) {
    playPromise.catch(error => {
      console.log('Autoplay prevented, waiting for user interaction');
      // If autoplay is blocked, wait for user to click somewhere
      document.addEventListener('click', function startMusic() {
        backgroundMusic.play();
        document.removeEventListener('click', startMusic);
      }, { once: true });
    });
  }
}

// Candle game initialization
function initCandleGame() {
  // Default settings
  const blowSensitivity = 50;
  const totalCandles = 3;

  // Initialize audio and blow detection
  navigator.mediaDevices.getUserMedia({ audio: true, video: false })
  .then(stream => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const microphone = audioContext.createMediaStreamSource(stream);
    const analyser = audioContext.createAnalyser();
    microphone.connect(analyser);
    analyser.fftSize = 512;

    const dataArray = new Uint8Array(analyser.frequencyBinCount);
    let allCandlesBlown = false;

    function detectBlow() {
      analyser.getByteFrequencyData(dataArray);
      let sum = 0;
      for(let i = 0; i < dataArray.length; i++){
        sum += dataArray[i];
      }
      let avg = sum / dataArray.length;

      const flames = document.querySelectorAll('.flame');
      
      // Blow out candles when blow is detected
      if(avg > blowSensitivity && !allCandlesBlown) {
        flames.forEach(flame => {
          // Add smoke effect
          flame.classList.add('smoke');
          
          // Create particle effect
          const rect = flame.getBoundingClientRect();
          createParticles(rect.left + rect.width / 2, rect.top, 15, '#ff9800');
          
          // Blow out flame after delay
          setTimeout(() => {
            flame.classList.add('blown');
          }, 300);
        });
        
        allCandlesBlown = true;
        
        // Show celebration modal after all candles are blown
        setTimeout(() => {
          document.getElementById('greetingModal').style.display = 'flex';
          createCelebrationParticles();
        }, 1000);
      }

      requestAnimationFrame(detectBlow);
    }

    detectBlow();
  })
  .catch(err => {
    console.error("Microphone access denied or not available:", err);
    const instructions = document.querySelector('.instructions');
    instructions.innerHTML = `
      <h2>Blow Out the Candles! üéÇ</h2>
      <p>Microphone not available - Please refresh and allow access</p>
      <p style="color: #ff4444; margin-top: 10px; font-size: 0.9rem;">Or click on the candles to blow them out!</p>
    `;
    
    // Add click to blow fallback
    document.querySelectorAll('.flame').forEach((flame, index) => {
      flame.style.cursor = 'pointer';
      flame.addEventListener('click', function() {
        if (!this.classList.contains('blown')) {
          this.classList.add('smoke');
          const rect = this.getBoundingClientRect();
          createParticles(rect.left + rect.width / 2, rect.top, 15, '#ff9800');
          setTimeout(() => {
            this.classList.add('blown');
            checkAllCandlesBlown();
          }, 300);
        }
      });
    });
  });
}

// Check if all candles are blown (for click fallback)
function checkAllCandlesBlown() {
  const flames = document.querySelectorAll('.flame');
  const allBlown = Array.from(flames).every(flame => flame.classList.contains('blown'));
  
  if (allBlown) {
    setTimeout(() => {
      document.getElementById('greetingModal').style.display = 'flex';
      createCelebrationParticles();
    }, 1000);
  }
}

// Create particle effect
function createParticles(x, y, count, color) {
  for (let i = 0; i < count; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = x + 'px';
    particle.style.top = y + 'px';
    particle.style.width = '4px';
    particle.style.height = '4px';
    particle.style.backgroundColor = color;
    particle.style.borderRadius = '50%';
    document.body.appendChild(particle);
    
    // Animate particle
    const angle = Math.random() * Math.PI * 2;
    const distance = Math.random() * 50 + 20;
    const duration = Math.random() * 1000 + 500;
    
    particle.animate([
      { transform: 'translate(0, 0) scale(1)', opacity: 1 },
      { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`, opacity: 0 }
    ], {
      duration: duration,
      easing: 'ease-out'
    }).onfinish = () => particle.remove();
  }
}

// Create celebration particles
function createCelebrationParticles() {
  for (let i = 0; i < 100; i++) {
    setTimeout(() => {
      const x = Math.random() * window.innerWidth;
      const y = Math.random() * window.innerHeight;
      const colors = ['#ff69b4', '#ffeb3b', '#4caf50', '#2196f3', '#9c27b0'];
      createParticles(x, y, 3, colors[Math.floor(Math.random() * colors.length)]);
    }, i * 50);
  }
}

// Initialize when page loads
window.addEventListener('load', function() {
  // Gift modal is already visible by default
  console.log('Birthday surprise ready!');
});
</script>

</body>
</html>